# 数据库设计与开发日志

## 📋 文档信息
- **文档版本**: V1.0
- **创建日期**: 2024年
- **项目名称**: 部门工作任务管理系统
- **数据库类型**: MySQL 8.0
- **字符集**: utf8mb4
- **排序规则**: utf8mb4_unicode_ci

---

## 🗄️ 数据库设计规范

### 命名规范
1. **表名**: 使用小写字母和下划线，复数形式 (如: `users`, `tasks`)
2. **字段名**: 使用小写字母和下划线 (如: `user_id`, `created_at`)
3. **索引名**: `idx_表名_字段名` (如: `idx_tasks_assignee_id`)
4. **外键名**: `fk_表名_字段名` (如: `fk_tasks_assignee_id`)

### 数据类型规范
1. **主键**: `BIGINT UNSIGNED AUTO_INCREMENT`
2. **外键**: `BIGINT UNSIGNED`
3. **时间戳**: `TIMESTAMP` (使用UTC时间)
4. **文本**: `VARCHAR(255)` 或 `TEXT`
5. **状态枚举**: `ENUM` 或 `VARCHAR(50)`
6. **布尔值**: `TINYINT(1)`

### 通用字段
每个表都应包含以下字段:
- `id`: 主键
- `created_at`: 创建时间
- `updated_at`: 更新时间
- `deleted_at`: 软删除时间 (可选)

---

## 📊 数据库表结构设计

### 1. 用户表 (users)
**表用途**: 存储系统用户信息

```sql
CREATE TABLE `users` (
  `id` BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  `username` VARCHAR(50) NOT NULL UNIQUE COMMENT '用户名',
  `password` VARCHAR(255) NOT NULL COMMENT '密码哈希',
  `name` VARCHAR(100) NOT NULL COMMENT '真实姓名',
  `email` VARCHAR(255) NOT NULL UNIQUE COMMENT '邮箱地址',
  `role` ENUM('admin', 'manager', 'member') NOT NULL DEFAULT 'member' COMMENT '用户角色',
  `status` ENUM('active', 'inactive') NOT NULL DEFAULT 'active' COMMENT '用户状态',
  `avatar` VARCHAR(255) NULL COMMENT '头像路径',
  `phone` VARCHAR(20) NULL COMMENT '手机号码',
  `department` VARCHAR(100) NULL COMMENT '部门',
  `position` VARCHAR(100) NULL COMMENT '职位',
  `last_login_at` TIMESTAMP NULL COMMENT '最后登录时间',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  
  INDEX `idx_users_username` (`username`),
  INDEX `idx_users_email` (`email`),
  INDEX `idx_users_role` (`role`),
  INDEX `idx_users_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户表';
```

**开发记录**:
- 设计时间: [待填写]
- 设计人员: [待填写]
- 创建状态: [待创建]
- 变更记录: [无]

### 2. 任务表 (tasks)
**表用途**: 存储任务基本信息

```sql
CREATE TABLE `tasks` (
  `id` BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  `title` VARCHAR(200) NOT NULL COMMENT '任务标题',
  `description` TEXT NULL COMMENT '任务描述',
  `status` ENUM('pending', 'in_progress', 'completed', 'paused', 'cancelled') NOT NULL DEFAULT 'pending' COMMENT '任务状态',
  `priority` ENUM('high', 'medium', 'low') NOT NULL DEFAULT 'medium' COMMENT '优先级',
  `category` ENUM('production', 'project', 'comprehensive') NOT NULL COMMENT '任务类别',
  `start_date` DATE NOT NULL COMMENT '开始日期',
  `end_date` DATE NOT NULL COMMENT '结束日期',
  `progress` TINYINT UNSIGNED DEFAULT 0 COMMENT '完成进度(0-100)',
  `assignee_id` BIGINT UNSIGNED NOT NULL COMMENT '负责人ID',
  `created_by` BIGINT UNSIGNED NOT NULL COMMENT '创建人ID',
  `parent_id` BIGINT UNSIGNED NULL COMMENT '父任务ID',
  `level` TINYINT UNSIGNED DEFAULT 1 COMMENT '任务层级(1-3)',
  `sort_order` INT DEFAULT 0 COMMENT '排序序号',
  `estimated_hours` DECIMAL(8,2) NULL COMMENT '预估工时',
  `actual_hours` DECIMAL(8,2) NULL COMMENT '实际工时',
  `completion_confirmed_by` BIGINT UNSIGNED NULL COMMENT '完成确认人ID',
  `completion_confirmed_at` TIMESTAMP NULL COMMENT '完成确认时间',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  
  INDEX `idx_tasks_assignee_id` (`assignee_id`),
  INDEX `idx_tasks_created_by` (`created_by`),
  INDEX `idx_tasks_parent_id` (`parent_id`),
  INDEX `idx_tasks_status` (`status`),
  INDEX `idx_tasks_priority` (`priority`),
  INDEX `idx_tasks_category` (`category`),
  INDEX `idx_tasks_start_date` (`start_date`),
  INDEX `idx_tasks_end_date` (`end_date`),
  INDEX `idx_tasks_level` (`level`),
  
  FOREIGN KEY `fk_tasks_assignee_id` (`assignee_id`) REFERENCES `users` (`id`) ON DELETE RESTRICT,
  FOREIGN KEY `fk_tasks_created_by` (`created_by`) REFERENCES `users` (`id`) ON DELETE RESTRICT,
  FOREIGN KEY `fk_tasks_parent_id` (`parent_id`) REFERENCES `tasks` (`id`) ON DELETE CASCADE,
  FOREIGN KEY `fk_tasks_completion_confirmed_by` (`completion_confirmed_by`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='任务表';
```

**开发记录**:
- 设计时间: [待填写]
- 设计人员: [待填写]
- 创建状态: [待创建]
- 变更记录: [无]

### 3. 任务协作人员表 (task_collaborators)
**表用途**: 存储任务的协作人员关系

```sql
CREATE TABLE `task_collaborators` (
  `id` BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  `task_id` BIGINT UNSIGNED NOT NULL COMMENT '任务ID',
  `user_id` BIGINT UNSIGNED NOT NULL COMMENT '协作人员ID',
  `role` VARCHAR(50) DEFAULT 'collaborator' COMMENT '协作角色',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  
  UNIQUE KEY `uk_task_collaborators` (`task_id`, `user_id`),
  INDEX `idx_task_collaborators_task_id` (`task_id`),
  INDEX `idx_task_collaborators_user_id` (`user_id`),
  
  FOREIGN KEY `fk_task_collaborators_task_id` (`task_id`) REFERENCES `tasks` (`id`) ON DELETE CASCADE,
  FOREIGN KEY `fk_task_collaborators_user_id` (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='任务协作人员表';
```

**开发记录**:
- 设计时间: [待填写]
- 设计人员: [待填写]
- 创建状态: [待创建]
- 变更记录: [无]

### 4. 任务依赖关系表 (task_dependencies)
**表用途**: 存储任务间的依赖关系

```sql
CREATE TABLE `task_dependencies` (
  `id` BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  `task_id` BIGINT UNSIGNED NOT NULL COMMENT '当前任务ID',
  `depends_on_task_id` BIGINT UNSIGNED NOT NULL COMMENT '依赖的任务ID',
  `dependency_type` ENUM('finish_to_start', 'start_to_start', 'finish_to_finish', 'start_to_finish') DEFAULT 'finish_to_start' COMMENT '依赖类型',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  
  UNIQUE KEY `uk_task_dependencies` (`task_id`, `depends_on_task_id`),
  INDEX `idx_task_dependencies_task_id` (`task_id`),
  INDEX `idx_task_dependencies_depends_on` (`depends_on_task_id`),
  
  FOREIGN KEY `fk_task_dependencies_task_id` (`task_id`) REFERENCES `tasks` (`id`) ON DELETE CASCADE,
  FOREIGN KEY `fk_task_dependencies_depends_on` (`depends_on_task_id`) REFERENCES `tasks` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='任务依赖关系表';
```

**开发记录**:
- 设计时间: [待填写]
- 设计人员: [待填写]
- 创建状态: [待创建]
- 变更记录: [无]

### 5. 任务步骤表 (task_steps)
**表用途**: 存储任务的To-Do List步骤

```sql
CREATE TABLE `task_steps` (
  `id` BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  `task_id` BIGINT UNSIGNED NOT NULL COMMENT '任务ID',
  `title` VARCHAR(200) NOT NULL COMMENT '步骤标题',
  `description` TEXT NULL COMMENT '步骤描述',
  `is_completed` TINYINT(1) DEFAULT 0 COMMENT '是否完成',
  `sort_order` INT DEFAULT 0 COMMENT '排序序号',
  `completed_by` BIGINT UNSIGNED NULL COMMENT '完成人ID',
  `completed_at` TIMESTAMP NULL COMMENT '完成时间',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  
  INDEX `idx_task_steps_task_id` (`task_id`),
  INDEX `idx_task_steps_sort_order` (`sort_order`),
  
  FOREIGN KEY `fk_task_steps_task_id` (`task_id`) REFERENCES `tasks` (`id`) ON DELETE CASCADE,
  FOREIGN KEY `fk_task_steps_completed_by` (`completed_by`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='任务步骤表';
```

**开发记录**:
- 设计时间: [待填写]
- 设计人员: [待填写]
- 创建状态: [待创建]
- 变更记录: [无]

### 6. 里程碑表 (milestones)
**表用途**: 存储项目里程碑信息

```sql
CREATE TABLE `milestones` (
  `id` BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  `task_id` BIGINT UNSIGNED NOT NULL COMMENT '关联任务ID',
  `title` VARCHAR(200) NOT NULL COMMENT '里程碑标题',
  `description` TEXT NULL COMMENT '里程碑描述',
  `target_date` DATE NOT NULL COMMENT '目标日期',
  `is_achieved` TINYINT(1) DEFAULT 0 COMMENT '是否达成',
  `achieved_date` DATE NULL COMMENT '实际达成日期',
  `reminder_days` TINYINT UNSIGNED DEFAULT 3 COMMENT '提前提醒天数',
  `created_by` BIGINT UNSIGNED NOT NULL COMMENT '创建人ID',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  
  INDEX `idx_milestones_task_id` (`task_id`),
  INDEX `idx_milestones_target_date` (`target_date`),
  INDEX `idx_milestones_created_by` (`created_by`),
  
  FOREIGN KEY `fk_milestones_task_id` (`task_id`) REFERENCES `tasks` (`id`) ON DELETE CASCADE,
  FOREIGN KEY `fk_milestones_created_by` (`created_by`) REFERENCES `users` (`id`) ON DELETE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='里程碑表';
```

**开发记录**:
- 设计时间: [待填写]
- 设计人员: [待填写]
- 创建状态: [待创建]
- 变更记录: [无]

### 7. 文件表 (files)
**表用途**: 存储上传文件信息

```sql
CREATE TABLE `files` (
  `id` BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  `filename` VARCHAR(255) NOT NULL COMMENT '存储文件名',
  `original_name` VARCHAR(255) NOT NULL COMMENT '原始文件名',
  `file_path` VARCHAR(500) NOT NULL COMMENT '文件存储路径',
  `file_size` BIGINT UNSIGNED NOT NULL COMMENT '文件大小(字节)',
  `mime_type` VARCHAR(100) NOT NULL COMMENT 'MIME类型',
  `file_extension` VARCHAR(10) NOT NULL COMMENT '文件扩展名',
  `task_id` BIGINT UNSIGNED NULL COMMENT '关联任务ID',
  `uploaded_by` BIGINT UNSIGNED NOT NULL COMMENT '上传人ID',
  `description` TEXT NULL COMMENT '文件描述',
  `download_count` INT UNSIGNED DEFAULT 0 COMMENT '下载次数',
  `is_deleted` TINYINT(1) DEFAULT 0 COMMENT '是否已删除',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  
  INDEX `idx_files_task_id` (`task_id`),
  INDEX `idx_files_uploaded_by` (`uploaded_by`),
  INDEX `idx_files_mime_type` (`mime_type`),
  INDEX `idx_files_created_at` (`created_at`),
  
  FOREIGN KEY `fk_files_task_id` (`task_id`) REFERENCES `tasks` (`id`) ON DELETE SET NULL,
  FOREIGN KEY `fk_files_uploaded_by` (`uploaded_by`) REFERENCES `users` (`id`) ON DELETE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='文件表';
```

**开发记录**:
- 设计时间: [待填写]
- 设计人员: [待填写]
- 创建状态: [待创建]
- 变更记录: [无]

### 8. 任务评论表 (task_comments)
**表用途**: 存储任务评论信息

```sql
CREATE TABLE `task_comments` (
  `id` BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  `task_id` BIGINT UNSIGNED NOT NULL COMMENT '任务ID',
  `user_id` BIGINT UNSIGNED NOT NULL COMMENT '评论人ID',
  `content` TEXT NOT NULL COMMENT '评论内容',
  `parent_id` BIGINT UNSIGNED NULL COMMENT '父评论ID(回复)',
  `is_deleted` TINYINT(1) DEFAULT 0 COMMENT '是否已删除',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  
  INDEX `idx_task_comments_task_id` (`task_id`),
  INDEX `idx_task_comments_user_id` (`user_id`),
  INDEX `idx_task_comments_parent_id` (`parent_id`),
  INDEX `idx_task_comments_created_at` (`created_at`),
  
  FOREIGN KEY `fk_task_comments_task_id` (`task_id`) REFERENCES `tasks` (`id`) ON DELETE CASCADE,
  FOREIGN KEY `fk_task_comments_user_id` (`user_id`) REFERENCES `users` (`id`) ON DELETE RESTRICT,
  FOREIGN KEY `fk_task_comments_parent_id` (`parent_id`) REFERENCES `task_comments` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='任务评论表';
```

**开发记录**:
- 设计时间: [待填写]
- 设计人员: [待填写]
- 创建状态: [待创建]
- 变更记录: [无]

### 9. 通知表 (notifications)
**表用途**: 存储系统通知信息

```sql
CREATE TABLE `notifications` (
  `id` BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  `user_id` BIGINT UNSIGNED NOT NULL COMMENT '接收用户ID',
  `title` VARCHAR(200) NOT NULL COMMENT '通知标题',
  `content` TEXT NOT NULL COMMENT '通知内容',
  `type` VARCHAR(50) NOT NULL COMMENT '通知类型',
  `related_type` VARCHAR(50) NULL COMMENT '关联对象类型',
  `related_id` BIGINT UNSIGNED NULL COMMENT '关联对象ID',
  `is_read` TINYINT(1) DEFAULT 0 COMMENT '是否已读',
  `read_at` TIMESTAMP NULL COMMENT '阅读时间',
  `priority` ENUM('high', 'medium', 'low') DEFAULT 'medium' COMMENT '优先级',
  `expires_at` TIMESTAMP NULL COMMENT '过期时间',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  
  INDEX `idx_notifications_user_id` (`user_id`),
  INDEX `idx_notifications_type` (`type`),
  INDEX `idx_notifications_is_read` (`is_read`),
  INDEX `idx_notifications_created_at` (`created_at`),
  INDEX `idx_notifications_expires_at` (`expires_at`),
  
  FOREIGN KEY `fk_notifications_user_id` (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='通知表';
```

**开发记录**:
- 设计时间: [待填写]
- 设计人员: [待填写]
- 创建状态: [待创建]
- 变更记录: [无]

### 10. 任务变更日志表 (task_change_logs)
**表用途**: 记录任务的所有变更历史

```sql
CREATE TABLE `task_change_logs` (
  `id` BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  `task_id` BIGINT UNSIGNED NOT NULL COMMENT '任务ID',
  `user_id` BIGINT UNSIGNED NOT NULL COMMENT '操作人ID',
  `action` VARCHAR(50) NOT NULL COMMENT '操作类型',
  `field_name` VARCHAR(100) NULL COMMENT '变更字段名',
  `old_value` TEXT NULL COMMENT '原值',
  `new_value` TEXT NULL COMMENT '新值',
  `description` TEXT NULL COMMENT '变更描述',
  `ip_address` VARCHAR(45) NULL COMMENT 'IP地址',
  `user_agent` TEXT NULL COMMENT '用户代理',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  
  INDEX `idx_task_change_logs_task_id` (`task_id`),
  INDEX `idx_task_change_logs_user_id` (`user_id`),
  INDEX `idx_task_change_logs_action` (`action`),
  INDEX `idx_task_change_logs_created_at` (`created_at`),
  
  FOREIGN KEY `fk_task_change_logs_task_id` (`task_id`) REFERENCES `tasks` (`id`) ON DELETE CASCADE,
  FOREIGN KEY `fk_task_change_logs_user_id` (`user_id`) REFERENCES `users` (`id`) ON DELETE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='任务变更日志表';
```

**开发记录**:
- 设计时间: [待填写]
- 设计人员: [待填写]
- 创建状态: [待创建]
- 变更记录: [无]

### 11. 系统操作日志表 (system_logs)
**表用途**: 记录系统关键操作日志

```sql
CREATE TABLE `system_logs` (
  `id` BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  `user_id` BIGINT UNSIGNED NULL COMMENT '操作人ID',
  `action` VARCHAR(100) NOT NULL COMMENT '操作类型',
  `module` VARCHAR(50) NOT NULL COMMENT '操作模块',
  `description` TEXT NOT NULL COMMENT '操作描述',
  `request_data` JSON NULL COMMENT '请求数据',
  `response_data` JSON NULL COMMENT '响应数据',
  `ip_address` VARCHAR(45) NULL COMMENT 'IP地址',
  `user_agent` TEXT NULL COMMENT '用户代理',
  `execution_time` DECIMAL(8,3) NULL COMMENT '执行时间(秒)',
  `status` ENUM('success', 'error', 'warning') DEFAULT 'success' COMMENT '执行状态',
  `error_message` TEXT NULL COMMENT '错误信息',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  
  INDEX `idx_system_logs_user_id` (`user_id`),
  INDEX `idx_system_logs_action` (`action`),
  INDEX `idx_system_logs_module` (`module`),
  INDEX `idx_system_logs_status` (`status`),
  INDEX `idx_system_logs_created_at` (`created_at`),
  
  FOREIGN KEY `fk_system_logs_user_id` (`user_id`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='系统操作日志表';
```

**开发记录**:
- 设计时间: [待填写]
- 设计人员: [待填写]
- 创建状态: [待创建]
- 变更记录: [无]

### 12. 系统配置表 (system_configs)
**表用途**: 存储系统配置参数

```sql
CREATE TABLE `system_configs` (
  `id` BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  `config_key` VARCHAR(100) NOT NULL UNIQUE COMMENT '配置键',
  `config_value` TEXT NOT NULL COMMENT '配置值',
  `config_type` ENUM('string', 'number', 'boolean', 'json') DEFAULT 'string' COMMENT '配置类型',
  `description` TEXT NULL COMMENT '配置描述',
  `is_editable` TINYINT(1) DEFAULT 1 COMMENT '是否可编辑',
  `category` VARCHAR(50) DEFAULT 'general' COMMENT '配置分类',
  `sort_order` INT DEFAULT 0 COMMENT '排序序号',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  
  INDEX `idx_system_configs_category` (`category`),
  INDEX `idx_system_configs_sort_order` (`sort_order`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='系统配置表';
```

**开发记录**:
- 设计时间: [待填写]
- 设计人员: [待填写]
- 创建状态: [待创建]
- 变更记录: [无]

---

## 🔗 数据库关系图

```
用户表 (users)
├── 任务表 (tasks) - assignee_id, created_by
├── 任务协作人员表 (task_collaborators) - user_id
├── 文件表 (files) - uploaded_by
├── 任务评论表 (task_comments) - user_id
├── 通知表 (notifications) - user_id
├── 任务变更日志表 (task_change_logs) - user_id
└── 系统操作日志表 (system_logs) - user_id

任务表 (tasks)
├── 任务协作人员表 (task_collaborators) - task_id
├── 任务依赖关系表 (task_dependencies) - task_id, depends_on_task_id
├── 任务步骤表 (task_steps) - task_id
├── 里程碑表 (milestones) - task_id
├── 文件表 (files) - task_id
├── 任务评论表 (task_comments) - task_id
└── 任务变更日志表 (task_change_logs) - task_id
```

---

## 📝 开发日志格式

### 数据库变更日志模板
```markdown
## 数据库变更记录

### 变更信息
- **变更日期**: YYYY-MM-DD HH:mm:ss
- **变更人员**: [姓名]
- **变更类型**: [新建表/修改表结构/删除表/新增索引/修改数据]
- **影响范围**: [影响的表和功能]

### 变更内容
#### 变更前
```sql
-- 原始SQL语句或表结构
```

#### 变更后
```sql
-- 新的SQL语句或表结构
```

### 变更原因
[详细说明变更的业务需求或技术原因]

### 影响评估
- **数据影响**: [是否影响现有数据]
- **功能影响**: [影响的功能模块]
- **性能影响**: [对查询性能的影响]
- **兼容性**: [向前兼容性说明]

### 回滚方案
```sql
-- 回滚SQL语句
```

### 测试验证
- [ ] 表结构创建成功
- [ ] 索引创建成功
- [ ] 外键约束正常
- [ ] 数据迁移成功
- [ ] 相关功能测试通过

### 部署说明
1. 备份相关表数据
2. 执行变更SQL
3. 验证变更结果
4. 更新相关文档
```

### 每日开发日志模板
```markdown
## 开发日志 - YYYY-MM-DD

### 今日数据库工作
#### 完成的表设计
- [ ] 表名1: 设计完成/创建完成/测试完成
- [ ] 表名2: 设计完成/创建完成/测试完成

#### 数据库变更
- 新增表: [表名] - [用途说明]
- 修改表: [表名] - [修改内容]
- 新增索引: [表名.字段名] - [索引类型]

#### 遇到的问题
1. **问题描述**: [具体问题]
   - **解决方案**: [解决过程]
   - **经验总结**: [避免类似问题的方法]

#### 性能优化
- 查询优化: [优化的查询语句]
- 索引优化: [新增或调整的索引]
- 数据结构优化: [结构调整说明]

### 明日计划
- [ ] 完成表设计: [表名列表]
- [ ] 创建数据库表: [表名列表]
- [ ] 编写测试数据: [相关表]
- [ ] 性能测试: [测试内容]

### 数据库统计
- 已完成表数量: X/总数
- 已创建索引数量: X个
- 已建立外键关系: X个
- 数据库大小: XMB
```

---

## 🔧 数据库初始化脚本

### 创建数据库
```sql
-- 创建数据库
CREATE DATABASE IF NOT EXISTS `task_management_system` 
DEFAULT CHARACTER SET utf8mb4 
DEFAULT COLLATE utf8mb4_unicode_ci;

-- 使用数据库
USE `task_management_system`;
```

### 初始化数据
```sql
-- 插入默认管理员用户
INSERT INTO `users` (`username`, `password`, `name`, `email`, `role`, `status`) VALUES
('admin', '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', '系统管理员', 'admin@example.com', 'admin', 'active');

-- 插入系统配置
INSERT INTO `system_configs` (`config_key`, `config_value`, `config_type`, `description`, `category`) VALUES
('system_name', '部门工作任务管理系统', 'string', '系统名称', 'general'),
('max_file_size', '20971520', 'number', '最大文件上传大小(字节)', 'file'),
('notification_retention_days', '14', 'number', '通知保留天数', 'notification'),
('reminder_days_before_deadline', '3', 'number', '截止前提醒天数', 'task'),
('auto_cleanup_enabled', 'true', 'boolean', '是否启用自动清理', 'system');
```

---

## 📊 数据库监控与维护

### 性能监控指标
1. **查询性能**
   - 慢查询日志监控
   - 查询执行时间统计
   - 索引使用情况分析

2. **存储监控**
   - 数据库大小增长趋势
   - 表空间使用情况
   - 索引空间占用

3. **连接监控**
   - 并发连接数
   - 连接池使用情况
   - 锁等待统计

### 维护计划
1. **日常维护**
   - 每日备份数据库
   - 监控慢查询日志
   - 检查错误日志

2. **周期维护**
   - 每周分析表统计信息
   - 每月清理过期数据
   - 每季度优化索引

3. **年度维护**
   - 数据归档策略执行
   - 数据库版本升级评估
   - 容量规划调整

---

## 🔄 版本控制

### 数据库版本管理
1. **版本命名规则**: `v主版本.次版本.修订版本`
2. **变更追踪**: 每次结构变更都要记录版本号
3. **迁移脚本**: 提供版本间的升级和降级脚本

### 当前版本
- **数据库版本**: v1.0.0
- **最后更新**: [待填写]
- **变更摘要**: 初始数据库设计

---

**维护说明**: 
1. 每次数据库结构变更都必须更新此文档
2. 所有SQL脚本都要经过测试验证
3. 重要变更需要提前备份数据
4. 定期review数据库设计的合理性

**责任人**: 
- 数据库设计: 架构师
- 结构维护: 后端开发工程师
- 文档更新: 项目经理
- 性能优化: DBA