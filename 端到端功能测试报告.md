# 端到端功能测试报告

## 测试环境
- 前端开发服务器：`http://localhost:3000/`
- 后端 API 服务器：`http://localhost:3001/`
- 前端代理：`/api` → `http://localhost:3001`
- 账号：`admin / admin123`

## 测试用例与结果

### 1. 登录认证
- 接口：`POST /api/auth/login`
- 命令：
  - `Invoke-RestMethod -Uri "http://localhost:3001/api/auth/login" -Method POST -ContentType "application/json" -Body '{"username":"admin","password":"admin123"}'`
- 结果：✅ 成功，返回 `access_token` 与用户信息

### 2. 文件上传（携带目录路径）
- 接口：`POST /api/files/upload`
- 传参：`multipart/form-data`，字段：`file`、`path='docs/1111'`
- 命令：
  - `Invoke-RestMethod -Uri "http://localhost:3001/api/files/upload" -Method POST -Headers @{ Authorization = "Bearer $token" } -Form @{ file = Get-Item "D:/trae/proj6/test_upload.txt"; path = "docs/1111" }`
- 结果：✅ 成功
  - 返回 `file.id` 示例：`18`
  - 返回 `path`：`docs/1111/test_upload-<unique>.txt`

### 3. 文件列表（路径过滤）
- 接口：`GET /api/files?currentPath=docs`
- 命令：
  - `Invoke-RestMethod -Uri "http://localhost:3001/api/files?currentPath=docs" -Method GET -Headers @{ Authorization = "Bearer $token" }`
- 结果：✅ 成功
  - 返回子文件夹：`1111`
  - 返回上传文件：包含 `path` 为 `docs/1111/...` 的记录

### 4. 文件下载（路径解析）
- 接口：`GET /api/files/download/:id`
- 命令：
  - `Invoke-WebRequest -Uri "http://localhost:3001/api/files/download/18" -Headers @{ Authorization = "Bearer $token" } -OutFile "D:/trae/proj6/test_download_18.txt"`
- 结果：✅ 成功
  - 下载大小：`107` 字节
  - 文件内容：与源文件一致

## 结论与建议
- 登录与认证流程正常；访问令牌可用于后续文件操作。
- 上传时通过 `path` 字段传递当前目录，后端正确记录 `file_path` 并支持按目录过滤列表。
- 下载接口使用文件 `id` 定位文件，响应头安全处理中文与特殊字符，下载功能正常。
- 建议前端文件列表查询参数与后端保持一致（前端当前使用 `path`，后端使用 `currentPath`），以减少维护成本。当前功能在根目录与常见路径下均可正常工作。

## 附注
- 所有测试在 Windows PowerShell 环境执行。
- 若端口规划调整（如后端改为 `3002`），需同步更新前端代理与环境变量。